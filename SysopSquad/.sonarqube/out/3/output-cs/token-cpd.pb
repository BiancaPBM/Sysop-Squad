Û?
WC:\TSP.NET\Sysop-Squad\SysopSquad\Account.Microservice\Controllers\AccountController.cs
	namespace 	
Account
 
. 
Microservice 
. 
Controllers *
{ 
[ 
Route 
( 	
$str	 
) 
] 
[ 
ApiController 
] 
public 
class	 
AccountController  
:! "
ControllerBase# 1
{ 
private 
readonly 
UserManager  
<  !
ApplicationUser! 0
>0 1
userManager2 =
;= >
private 
readonly 
IConfiguration #
_configuration$ 2
;2 3
public 

AccountController 
( 
UserManager (
<( )
ApplicationUser) 8
>8 9
userManager: E
,E F
IConfigurationG U
configurationV c
)c d
{ 
this 

.
 
userManager 
= 
userManager $
;$ %
_configuration   
=   
configuration   $
;  $ %
}!! 
[## 
HttpPost## 
]## 
[$$ 
Route$$ 

($$
 
$str$$ 
)$$ 
]$$ 
public%% 

async%% 
Task%% 
<%% 
IActionResult%% #
>%%# $
Login%%% *
(%%* +
[%%+ ,
FromBody%%, 4
]%%4 5

LoginModel%%6 @
model%%A F
)%%F G
{&& 
var'' 	
user''
 
='' 
await'' 
userManager'' "
.''" #
FindByNameAsync''# 2
(''2 3
model''3 8
.''8 9
Username''9 A
)''A B
;''B C
if(( 
(((	 

user((
 
!=(( 
null(( 
&&(( 
await(( 
userManager((  +
.((+ ,
CheckPasswordAsync((, >
(((> ?
user((? C
,((C D
model((E J
.((J K
Password((K S
)((S T
)((T U
{)) 
var** 
	userRoles** 
=** 
await** 
userManager** )
.**) *
GetRolesAsync*** 7
(**7 8
user**8 <
)**< =
;**= >
var,, 

authClaims,, 
=,, 
new,, 
List,, !
<,,! "
Claim,," '
>,,' (
{-- 
new.. 
Claim.. 
(.. 

ClaimTypes.. (
...( )
Name..) -
,..- .
user../ 3
...3 4
UserName..4 <
)..< =
,..= >
new// 
Claim// 
(// #
JwtRegisteredClaimNames// 5
.//5 6
Jti//6 9
,//9 :
Guid//; ?
.//? @
NewGuid//@ G
(//G H
)//H I
.//I J
ToString//J R
(//R S
)//S T
)//T U
,//U V
}00 
;00 
foreach22 
(22 
var22 
userRole22 
in22  
	userRoles22! *
)22* +
{33 	

authClaims44
 
.44 
Add44 
(44 
new44 
Claim44 "
(44" #

ClaimTypes44# -
.44- .
Role44. 2
,442 3
userRole444 <
)44< =
)44= >
;44> ?
}55 	
var77 
authSigningKey77 
=77 
new77   
SymmetricSecurityKey77! 5
(775 6
Encoding776 >
.77> ?
UTF877? C
.77C D
GetBytes77D L
(77L M
_configuration77M [
[77[ \
$str77\ h
]77h i
)77i j
)77j k
;77k l
var99 
token99 
=99 
new99 
JwtSecurityToken99 (
(99( )
issuer:: 
::: 
_configuration:: "
[::" #
$str::# 4
]::4 5
,::5 6
audience;; 
:;; 
_configuration;; $
[;;$ %
$str;;% 8
];;8 9
,;;9 :
expires<< 
:<< 
DateTime<< 
.<< 
Now<< !
.<<! "
AddHours<<" *
(<<* +
$num<<+ ,
)<<, -
,<<- .
claims== 
:== 

authClaims== 
,== 
signingCredentials>> 
:>> 
new>>  #
SigningCredentials>>$ 6
(>>6 7
authSigningKey>>7 E
,>>E F
SecurityAlgorithms>>G Y
.>>Y Z

HmacSha256>>Z d
)>>d e
)?? 
;?? 
returnAA 
OkAA 
(AA 
newAA 
{BB 	
tokenCC
 
=CC 
newCC #
JwtSecurityTokenHandlerCC -
(CC- .
)CC. /
.CC/ 0

WriteTokenCC0 :
(CC: ;
tokenCC; @
)CC@ A
,CCA B

expirationDD
 
=DD 
tokenDD 
.DD 
ValidToDD $
,DD$ %
usernameEE
 
=EE 
userEE 
.EE 
UserNameEE "
}FF 	
)FF	 

;FF
 
}GG 
returnHH 
UnauthorizedHH 
(HH 
)HH 
;HH 
}II 
[KK 
HttpPostKK 
]KK 
[LL 
RouteLL 

(LL
 
$strLL 
)LL 
]LL 
publicMM 

asyncMM 
TaskMM 
<MM 
IActionResultMM #
>MM# $
RegisterMM% -
(MM- .
[MM. /
FromBodyMM/ 7
]MM7 8
RegisterModelMM9 F
modelMMG L
)MML M
{NN 
varOO 	

userExistsOO
 
=OO 
awaitOO 
userManagerOO (
.OO( )
FindByNameAsyncOO) 8
(OO8 9
modelOO9 >
.OO> ?
UsernameOO? G
)OOG H
;OOH I
ifPP 
(PP	 


userExistsPP
 
!=PP 
nullPP 
)PP 
returnQQ 

StatusCodeQQ 
(QQ 
StatusCodesQQ %
.QQ% &(
Status500InternalServerErrorQQ& B
,QQB C
newQQD G
ResponseQQH P
{QQQ R
StatusQQS Y
=QQZ [
$strQQ\ c
,QQc d
MessageQQe l
=QQm n
$str	QQo Ö
}
QQÜ á
)
QQá à
;
QQà â
ApplicationUserSS 
userSS 
=SS 
newSS  
ApplicationUserSS! 0
(SS0 1
)SS1 2
{TT 
EmailUU 
=UU 
modelUU 
.UU 
EmailUU 
,UU 
SecurityStampVV 
=VV 
GuidVV 
.VV 
NewGuidVV $
(VV$ %
)VV% &
.VV& '
ToStringVV' /
(VV/ 0
)VV0 1
,VV1 2
UserNameWW 
=WW 
modelWW 
.WW 
UsernameWW !
}XX 
;XX 
varYY 	
resultYY
 
=YY 
awaitYY 
userManagerYY $
.YY$ %
CreateAsyncYY% 0
(YY0 1
userYY1 5
,YY5 6
modelYY7 <
.YY< =
PasswordYY= E
)YYE F
;YYF G
ifZZ 
(ZZ	 

!ZZ
 
resultZZ 
.ZZ 
	SucceededZZ 
)ZZ 
return[[ 

StatusCode[[ 
([[ 
StatusCodes[[ %
.[[% &(
Status500InternalServerError[[& B
,[[B C
new[[D G
Response[[H P
{[[Q R
Status[[S Y
=[[Z [
$str[[\ c
,[[c d
Message[[e l
=[[m n
$str	[[o Ø
}
[[∞ ±
)
[[± ≤
;
[[≤ ≥
return]] 
Ok]] 
(]] 
)]] 
;]] 
}^^ 
}__ 
}`` ≥
SC:\TSP.NET\Sysop-Squad\SysopSquad\Account.Microservice\Data\ApplicationDbContext.cs
	namespace		 	
Account		
 
.		 
Microservice		 
.		 
Data		 #
{

 
public 
class	  
ApplicationDbContext #
:$ %
IdentityDbContext& 7
<7 8
ApplicationUser8 G
>G H
{ 
public 
 
ApplicationDbContext 
(  
DbContextOptions  0
<0 1 
ApplicationDbContext1 E
>E F
optionsG N
)N O
:P Q
baseR V
(V W
optionsW ^
)^ _
{ 
} 
	protected 
override 
void 
OnModelCreating +
(+ ,
ModelBuilder, 8
builder9 @
)@ A
{ 
base 

.
 
OnModelCreating 
( 
builder "
)" #
;# $
} 
} 
} ﬂ≈
aC:\TSP.NET\Sysop-Squad\SysopSquad\Account.Microservice\Migrations\20210419194739_InitialCreate.cs
	namespace 	
Account
 
. 
Microservice 
. 

Migrations )
{ 
public 

partial 
class 
InitialCreate &
:' (
	Migration) 2
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{		 	
migrationBuilder

 
.

 
CreateTable

 (
(

( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
string& ,
>, -
(- .
type. 2
:2 3
$str4 C
,C D
nullableE M
:M N
falseO T
)T U
,U V
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 E
,E F
	maxLengthG P
:P Q
$numR U
,U V
nullableW _
:_ `
truea e
)e f
,f g
NormalizedName "
=# $
table% *
.* +
Column+ 1
<1 2
string2 8
>8 9
(9 :
type: >
:> ?
$str@ O
,O P
	maxLengthQ Z
:Z [
$num\ _
,_ `
nullablea i
:i j
truek o
)o p
,p q
ConcurrencyStamp $
=% &
table' ,
., -
Column- 3
<3 4
string4 :
>: ;
(; <
type< @
:@ A
$strB Q
,Q R
nullableS [
:[ \
true] a
)a b
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 5
,5 6
x7 8
=>9 ;
x< =
.= >
Id> @
)@ A
;A B
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
string& ,
>, -
(- .
type. 2
:2 3
$str4 C
,C D
nullableE M
:M N
falseO T
)T U
,U V
UserName 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: I
,I J
	maxLengthK T
:T U
$numV Y
,Y Z
nullable[ c
:c d
truee i
)i j
,j k
NormalizedUserName &
=' (
table) .
.. /
Column/ 5
<5 6
string6 <
>< =
(= >
type> B
:B C
$strD S
,S T
	maxLengthU ^
:^ _
$num` c
,c d
nullablee m
:m n
trueo s
)s t
,t u
Email 
= 
table !
.! "
Column" (
<( )
string) /
>/ 0
(0 1
type1 5
:5 6
$str7 F
,F G
	maxLengthH Q
:Q R
$numS V
,V W
nullableX `
:` a
trueb f
)f g
,g h
NormalizedEmail   #
=  $ %
table  & +
.  + ,
Column  , 2
<  2 3
string  3 9
>  9 :
(  : ;
type  ; ?
:  ? @
$str  A P
,  P Q
	maxLength  R [
:  [ \
$num  ] `
,  ` a
nullable  b j
:  j k
true  l p
)  p q
,  q r
EmailConfirmed!! "
=!!# $
table!!% *
.!!* +
Column!!+ 1
<!!1 2
bool!!2 6
>!!6 7
(!!7 8
type!!8 <
:!!< =
$str!!> C
,!!C D
nullable!!E M
:!!M N
false!!O T
)!!T U
,!!U V
PasswordHash""  
=""! "
table""# (
.""( )
Column"") /
<""/ 0
string""0 6
>""6 7
(""7 8
type""8 <
:""< =
$str""> M
,""M N
nullable""O W
:""W X
true""Y ]
)""] ^
,""^ _
SecurityStamp## !
=##" #
table##$ )
.##) *
Column##* 0
<##0 1
string##1 7
>##7 8
(##8 9
type##9 =
:##= >
$str##? N
,##N O
nullable##P X
:##X Y
true##Z ^
)##^ _
,##_ `
ConcurrencyStamp$$ $
=$$% &
table$$' ,
.$$, -
Column$$- 3
<$$3 4
string$$4 :
>$$: ;
($$; <
type$$< @
:$$@ A
$str$$B Q
,$$Q R
nullable$$S [
:$$[ \
true$$] a
)$$a b
,$$b c
PhoneNumber%% 
=%%  !
table%%" '
.%%' (
Column%%( .
<%%. /
string%%/ 5
>%%5 6
(%%6 7
type%%7 ;
:%%; <
$str%%= L
,%%L M
nullable%%N V
:%%V W
true%%X \
)%%\ ]
,%%] ^ 
PhoneNumberConfirmed&& (
=&&) *
table&&+ 0
.&&0 1
Column&&1 7
<&&7 8
bool&&8 <
>&&< =
(&&= >
type&&> B
:&&B C
$str&&D I
,&&I J
nullable&&K S
:&&S T
false&&U Z
)&&Z [
,&&[ \
TwoFactorEnabled'' $
=''% &
table''' ,
.'', -
Column''- 3
<''3 4
bool''4 8
>''8 9
(''9 :
type'': >
:''> ?
$str''@ E
,''E F
nullable''G O
:''O P
false''Q V
)''V W
,''W X

LockoutEnd(( 
=((  
table((! &
.((& '
Column((' -
<((- .
DateTimeOffset((. <
>((< =
(((= >
type((> B
:((B C
$str((D T
,((T U
nullable((V ^
:((^ _
true((` d
)((d e
,((e f
LockoutEnabled)) "
=))# $
table))% *
.))* +
Column))+ 1
<))1 2
bool))2 6
>))6 7
())7 8
type))8 <
:))< =
$str))> C
,))C D
nullable))E M
:))M N
false))O T
)))T U
,))U V
AccessFailedCount** %
=**& '
table**( -
.**- .
Column**. 4
<**4 5
int**5 8
>**8 9
(**9 :
type**: >
:**> ?
$str**@ E
,**E F
nullable**G O
:**O P
false**Q V
)**V W
}++ 
,++ 
constraints,, 
:,, 
table,, "
=>,,# %
{-- 
table.. 
... 

PrimaryKey.. $
(..$ %
$str..% 5
,..5 6
x..7 8
=>..9 ;
x..< =
...= >
Id..> @
)..@ A
;..A B
}// 
)// 
;// 
migrationBuilder11 
.11 
CreateTable11 (
(11( )
name22 
:22 
$str22 (
,22( )
columns33 
:33 
table33 
=>33 !
new33" %
{44 
Id55 
=55 
table55 
.55 
Column55 %
<55% &
int55& )
>55) *
(55* +
type55+ /
:55/ 0
$str551 6
,556 7
nullable558 @
:55@ A
false55B G
)55G H
.66 

Annotation66 #
(66# $
$str66$ 8
,668 9
$str66: @
)66@ A
,66A B
RoleId77 
=77 
table77 "
.77" #
Column77# )
<77) *
string77* 0
>770 1
(771 2
type772 6
:776 7
$str778 G
,77G H
nullable77I Q
:77Q R
false77S X
)77X Y
,77Y Z
	ClaimType88 
=88 
table88  %
.88% &
Column88& ,
<88, -
string88- 3
>883 4
(884 5
type885 9
:889 :
$str88; J
,88J K
nullable88L T
:88T U
true88V Z
)88Z [
,88[ \

ClaimValue99 
=99  
table99! &
.99& '
Column99' -
<99- .
string99. 4
>994 5
(995 6
type996 :
:99: ;
$str99< K
,99K L
nullable99M U
:99U V
true99W [
)99[ \
}:: 
,:: 
constraints;; 
:;; 
table;; "
=>;;# %
{<< 
table== 
.== 

PrimaryKey== $
(==$ %
$str==% :
,==: ;
x==< =
=>==> @
x==A B
.==B C
Id==C E
)==E F
;==F G
table>> 
.>> 

ForeignKey>> $
(>>$ %
name?? 
:?? 
$str?? F
,??F G
column@@ 
:@@ 
x@@  !
=>@@" $
x@@% &
.@@& '
RoleId@@' -
,@@- .
principalTableAA &
:AA& '
$strAA( 5
,AA5 6
principalColumnBB '
:BB' (
$strBB) -
,BB- .
onDeleteCC  
:CC  !
ReferentialActionCC" 3
.CC3 4
CascadeCC4 ;
)CC; <
;CC< =
}DD 
)DD 
;DD 
migrationBuilderFF 
.FF 
CreateTableFF (
(FF( )
nameGG 
:GG 
$strGG (
,GG( )
columnsHH 
:HH 
tableHH 
=>HH !
newHH" %
{II 
IdJJ 
=JJ 
tableJJ 
.JJ 
ColumnJJ %
<JJ% &
intJJ& )
>JJ) *
(JJ* +
typeJJ+ /
:JJ/ 0
$strJJ1 6
,JJ6 7
nullableJJ8 @
:JJ@ A
falseJJB G
)JJG H
.KK 

AnnotationKK #
(KK# $
$strKK$ 8
,KK8 9
$strKK: @
)KK@ A
,KKA B
UserIdLL 
=LL 
tableLL "
.LL" #
ColumnLL# )
<LL) *
stringLL* 0
>LL0 1
(LL1 2
typeLL2 6
:LL6 7
$strLL8 G
,LLG H
nullableLLI Q
:LLQ R
falseLLS X
)LLX Y
,LLY Z
	ClaimTypeMM 
=MM 
tableMM  %
.MM% &
ColumnMM& ,
<MM, -
stringMM- 3
>MM3 4
(MM4 5
typeMM5 9
:MM9 :
$strMM; J
,MMJ K
nullableMML T
:MMT U
trueMMV Z
)MMZ [
,MM[ \

ClaimValueNN 
=NN  
tableNN! &
.NN& '
ColumnNN' -
<NN- .
stringNN. 4
>NN4 5
(NN5 6
typeNN6 :
:NN: ;
$strNN< K
,NNK L
nullableNNM U
:NNU V
trueNNW [
)NN[ \
}OO 
,OO 
constraintsPP 
:PP 
tablePP "
=>PP# %
{QQ 
tableRR 
.RR 

PrimaryKeyRR $
(RR$ %
$strRR% :
,RR: ;
xRR< =
=>RR> @
xRRA B
.RRB C
IdRRC E
)RRE F
;RRF G
tableSS 
.SS 

ForeignKeySS $
(SS$ %
nameTT 
:TT 
$strTT F
,TTF G
columnUU 
:UU 
xUU  !
=>UU" $
xUU% &
.UU& '
UserIdUU' -
,UU- .
principalTableVV &
:VV& '
$strVV( 5
,VV5 6
principalColumnWW '
:WW' (
$strWW) -
,WW- .
onDeleteXX  
:XX  !
ReferentialActionXX" 3
.XX3 4
CascadeXX4 ;
)XX; <
;XX< =
}YY 
)YY 
;YY 
migrationBuilder[[ 
.[[ 
CreateTable[[ (
([[( )
name\\ 
:\\ 
$str\\ (
,\\( )
columns]] 
:]] 
table]] 
=>]] !
new]]" %
{^^ 
LoginProvider__ !
=__" #
table__$ )
.__) *
Column__* 0
<__0 1
string__1 7
>__7 8
(__8 9
type__9 =
:__= >
$str__? N
,__N O
nullable__P X
:__X Y
false__Z _
)___ `
,__` a
ProviderKey`` 
=``  !
table``" '
.``' (
Column``( .
<``. /
string``/ 5
>``5 6
(``6 7
type``7 ;
:``; <
$str``= L
,``L M
nullable``N V
:``V W
false``X ]
)``] ^
,``^ _
ProviderDisplayNameaa '
=aa( )
tableaa* /
.aa/ 0
Columnaa0 6
<aa6 7
stringaa7 =
>aa= >
(aa> ?
typeaa? C
:aaC D
$straaE T
,aaT U
nullableaaV ^
:aa^ _
trueaa` d
)aad e
,aae f
UserIdbb 
=bb 
tablebb "
.bb" #
Columnbb# )
<bb) *
stringbb* 0
>bb0 1
(bb1 2
typebb2 6
:bb6 7
$strbb8 G
,bbG H
nullablebbI Q
:bbQ R
falsebbS X
)bbX Y
}cc 
,cc 
constraintsdd 
:dd 
tabledd "
=>dd# %
{ee 
tableff 
.ff 

PrimaryKeyff $
(ff$ %
$strff% :
,ff: ;
xff< =
=>ff> @
newffA D
{ffE F
xffG H
.ffH I
LoginProviderffI V
,ffV W
xffX Y
.ffY Z
ProviderKeyffZ e
}fff g
)ffg h
;ffh i
tablegg 
.gg 

ForeignKeygg $
(gg$ %
namehh 
:hh 
$strhh F
,hhF G
columnii 
:ii 
xii  !
=>ii" $
xii% &
.ii& '
UserIdii' -
,ii- .
principalTablejj &
:jj& '
$strjj( 5
,jj5 6
principalColumnkk '
:kk' (
$strkk) -
,kk- .
onDeletell  
:ll  !
ReferentialActionll" 3
.ll3 4
Cascadell4 ;
)ll; <
;ll< =
}mm 
)mm 
;mm 
migrationBuilderoo 
.oo 
CreateTableoo (
(oo( )
namepp 
:pp 
$strpp '
,pp' (
columnsqq 
:qq 
tableqq 
=>qq !
newqq" %
{rr 
UserIdss 
=ss 
tabless "
.ss" #
Columnss# )
<ss) *
stringss* 0
>ss0 1
(ss1 2
typess2 6
:ss6 7
$strss8 G
,ssG H
nullablessI Q
:ssQ R
falsessS X
)ssX Y
,ssY Z
RoleIdtt 
=tt 
tablett "
.tt" #
Columntt# )
<tt) *
stringtt* 0
>tt0 1
(tt1 2
typett2 6
:tt6 7
$strtt8 G
,ttG H
nullablettI Q
:ttQ R
falsettS X
)ttX Y
}uu 
,uu 
constraintsvv 
:vv 
tablevv "
=>vv# %
{ww 
tablexx 
.xx 

PrimaryKeyxx $
(xx$ %
$strxx% 9
,xx9 :
xxx; <
=>xx= ?
newxx@ C
{xxD E
xxxF G
.xxG H
UserIdxxH N
,xxN O
xxxP Q
.xxQ R
RoleIdxxR X
}xxY Z
)xxZ [
;xx[ \
tableyy 
.yy 

ForeignKeyyy $
(yy$ %
namezz 
:zz 
$strzz E
,zzE F
column{{ 
:{{ 
x{{  !
=>{{" $
x{{% &
.{{& '
RoleId{{' -
,{{- .
principalTable|| &
:||& '
$str||( 5
,||5 6
principalColumn}} '
:}}' (
$str}}) -
,}}- .
onDelete~~  
:~~  !
ReferentialAction~~" 3
.~~3 4
Cascade~~4 ;
)~~; <
;~~< =
table 
. 

ForeignKey $
($ %
name
ÄÄ 
:
ÄÄ 
$str
ÄÄ E
,
ÄÄE F
column
ÅÅ 
:
ÅÅ 
x
ÅÅ  !
=>
ÅÅ" $
x
ÅÅ% &
.
ÅÅ& '
UserId
ÅÅ' -
,
ÅÅ- .
principalTable
ÇÇ &
:
ÇÇ& '
$str
ÇÇ( 5
,
ÇÇ5 6
principalColumn
ÉÉ '
:
ÉÉ' (
$str
ÉÉ) -
,
ÉÉ- .
onDelete
ÑÑ  
:
ÑÑ  !
ReferentialAction
ÑÑ" 3
.
ÑÑ3 4
Cascade
ÑÑ4 ;
)
ÑÑ; <
;
ÑÑ< =
}
ÖÖ 
)
ÖÖ 
;
ÖÖ 
migrationBuilder
áá 
.
áá 
CreateTable
áá (
(
áá( )
name
àà 
:
àà 
$str
àà (
,
àà( )
columns
ââ 
:
ââ 
table
ââ 
=>
ââ !
new
ââ" %
{
ää 
UserId
ãã 
=
ãã 
table
ãã "
.
ãã" #
Column
ãã# )
<
ãã) *
string
ãã* 0
>
ãã0 1
(
ãã1 2
type
ãã2 6
:
ãã6 7
$str
ãã8 G
,
ããG H
nullable
ããI Q
:
ããQ R
false
ããS X
)
ããX Y
,
ããY Z
LoginProvider
åå !
=
åå" #
table
åå$ )
.
åå) *
Column
åå* 0
<
åå0 1
string
åå1 7
>
åå7 8
(
åå8 9
type
åå9 =
:
åå= >
$str
åå? N
,
ååN O
nullable
ååP X
:
ååX Y
false
ååZ _
)
åå_ `
,
åå` a
Name
çç 
=
çç 
table
çç  
.
çç  !
Column
çç! '
<
çç' (
string
çç( .
>
çç. /
(
çç/ 0
type
çç0 4
:
çç4 5
$str
çç6 E
,
ççE F
nullable
ççG O
:
ççO P
false
ççQ V
)
ççV W
,
ççW X
Value
éé 
=
éé 
table
éé !
.
éé! "
Column
éé" (
<
éé( )
string
éé) /
>
éé/ 0
(
éé0 1
type
éé1 5
:
éé5 6
$str
éé7 F
,
ééF G
nullable
ééH P
:
ééP Q
true
ééR V
)
ééV W
}
èè 
,
èè 
constraints
êê 
:
êê 
table
êê "
=>
êê# %
{
ëë 
table
íí 
.
íí 

PrimaryKey
íí $
(
íí$ %
$str
íí% :
,
íí: ;
x
íí< =
=>
íí> @
new
ííA D
{
ííE F
x
ííG H
.
ííH I
UserId
ííI O
,
ííO P
x
ííQ R
.
ííR S
LoginProvider
ííS `
,
íí` a
x
ííb c
.
ííc d
Name
ííd h
}
ííi j
)
ííj k
;
íík l
table
ìì 
.
ìì 

ForeignKey
ìì $
(
ìì$ %
name
îî 
:
îî 
$str
îî F
,
îîF G
column
ïï 
:
ïï 
x
ïï  !
=>
ïï" $
x
ïï% &
.
ïï& '
UserId
ïï' -
,
ïï- .
principalTable
ññ &
:
ññ& '
$str
ññ( 5
,
ññ5 6
principalColumn
óó '
:
óó' (
$str
óó) -
,
óó- .
onDelete
òò  
:
òò  !
ReferentialAction
òò" 3
.
òò3 4
Cascade
òò4 ;
)
òò; <
;
òò< =
}
ôô 
)
ôô 
;
ôô 
migrationBuilder
õõ 
.
õõ 
CreateIndex
õõ (
(
õõ( )
name
úú 
:
úú 
$str
úú 2
,
úú2 3
table
ùù 
:
ùù 
$str
ùù )
,
ùù) *
column
ûû 
:
ûû 
$str
ûû  
)
ûû  !
;
ûû! "
migrationBuilder
†† 
.
†† 
CreateIndex
†† (
(
††( )
name
°° 
:
°° 
$str
°° %
,
°°% &
table
¢¢ 
:
¢¢ 
$str
¢¢ $
,
¢¢$ %
column
££ 
:
££ 
$str
££ (
,
££( )
unique
§§ 
:
§§ 
true
§§ 
,
§§ 
filter
•• 
:
•• 
$str
•• 6
)
••6 7
;
••7 8
migrationBuilder
ßß 
.
ßß 
CreateIndex
ßß (
(
ßß( )
name
®® 
:
®® 
$str
®® 2
,
®®2 3
table
©© 
:
©© 
$str
©© )
,
©©) *
column
™™ 
:
™™ 
$str
™™  
)
™™  !
;
™™! "
migrationBuilder
¨¨ 
.
¨¨ 
CreateIndex
¨¨ (
(
¨¨( )
name
≠≠ 
:
≠≠ 
$str
≠≠ 2
,
≠≠2 3
table
ÆÆ 
:
ÆÆ 
$str
ÆÆ )
,
ÆÆ) *
column
ØØ 
:
ØØ 
$str
ØØ  
)
ØØ  !
;
ØØ! "
migrationBuilder
±± 
.
±± 
CreateIndex
±± (
(
±±( )
name
≤≤ 
:
≤≤ 
$str
≤≤ 1
,
≤≤1 2
table
≥≥ 
:
≥≥ 
$str
≥≥ (
,
≥≥( )
column
¥¥ 
:
¥¥ 
$str
¥¥  
)
¥¥  !
;
¥¥! "
migrationBuilder
∂∂ 
.
∂∂ 
CreateIndex
∂∂ (
(
∂∂( )
name
∑∑ 
:
∑∑ 
$str
∑∑ "
,
∑∑" #
table
∏∏ 
:
∏∏ 
$str
∏∏ $
,
∏∏$ %
column
ππ 
:
ππ 
$str
ππ )
)
ππ) *
;
ππ* +
migrationBuilder
ªª 
.
ªª 
CreateIndex
ªª (
(
ªª( )
name
ºº 
:
ºº 
$str
ºº %
,
ºº% &
table
ΩΩ 
:
ΩΩ 
$str
ΩΩ $
,
ΩΩ$ %
column
ææ 
:
ææ 
$str
ææ ,
,
ææ, -
unique
øø 
:
øø 
true
øø 
,
øø 
filter
¿¿ 
:
¿¿ 
$str
¿¿ :
)
¿¿: ;
;
¿¿; <
}
¡¡ 	
	protected
√√ 
override
√√ 
void
√√ 
Down
√√  $
(
√√$ %
MigrationBuilder
√√% 5
migrationBuilder
√√6 F
)
√√F G
{
ƒƒ 	
migrationBuilder
≈≈ 
.
≈≈ 
	DropTable
≈≈ &
(
≈≈& '
name
∆∆ 
:
∆∆ 
$str
∆∆ (
)
∆∆( )
;
∆∆) *
migrationBuilder
»» 
.
»» 
	DropTable
»» &
(
»»& '
name
…… 
:
…… 
$str
…… (
)
……( )
;
……) *
migrationBuilder
ÀÀ 
.
ÀÀ 
	DropTable
ÀÀ &
(
ÀÀ& '
name
ÃÃ 
:
ÃÃ 
$str
ÃÃ (
)
ÃÃ( )
;
ÃÃ) *
migrationBuilder
ŒŒ 
.
ŒŒ 
	DropTable
ŒŒ &
(
ŒŒ& '
name
œœ 
:
œœ 
$str
œœ '
)
œœ' (
;
œœ( )
migrationBuilder
—— 
.
—— 
	DropTable
—— &
(
——& '
name
““ 
:
““ 
$str
““ (
)
““( )
;
““) *
migrationBuilder
‘‘ 
.
‘‘ 
	DropTable
‘‘ &
(
‘‘& '
name
’’ 
:
’’ 
$str
’’ #
)
’’# $
;
’’$ %
migrationBuilder
◊◊ 
.
◊◊ 
	DropTable
◊◊ &
(
◊◊& '
name
ÿÿ 
:
ÿÿ 
$str
ÿÿ #
)
ÿÿ# $
;
ÿÿ$ %
}
ŸŸ 	
}
⁄⁄ 
}€€ Î
OC:\TSP.NET\Sysop-Squad\SysopSquad\Account.Microservice\Model\ApplicationUser.cs
	namespace 	
Account
 
. 
Microservice 
. 
Model $
{ 
public		 
class			 
ApplicationUser		 
:		 
IdentityUser		  ,
{

 
} 
} ä
JC:\TSP.NET\Sysop-Squad\SysopSquad\Account.Microservice\Model\LoginModel.cs
	namespace 	
Account
 
. 
Microservice 
. 
Model $
{ 
public		 
class			 

LoginModel		 
{

 
[ 
Required 
( 
ErrorMessage 
= 
$str 4
)4 5
]5 6
public 

string 
Username 
{ 
get  
;  !
set" %
;% &
}' (
[ 
Required 
( 
ErrorMessage 
= 
$str 3
)3 4
]4 5
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
} 
} Ó	
MC:\TSP.NET\Sysop-Squad\SysopSquad\Account.Microservice\Model\RegisterModel.cs
	namespace 	
Account
 
. 
Microservice 
. 
Model $
{ 
public 
class	 
RegisterModel 
{ 
[ 
Required 
( 
ErrorMessage 
= 
$str 4
)4 5
]5 6
public 

string 
Username 
{ 
get  
;  !
set" %
;% &
}' (
[

 
EmailAddress

 
]

 
[ 
Required 
( 
ErrorMessage 
= 
$str 0
)0 1
]1 2
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
[ 
Required 
( 
ErrorMessage 
= 
$str 3
)3 4
]4 5
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
} 
} È
HC:\TSP.NET\Sysop-Squad\SysopSquad\Account.Microservice\Model\Response.cs
	namespace 	
Account
 
. 
Microservice 
. 
Model $
{ 
public 
class	 
Response 
{		 
public

 

string

 
Status

 
{

 
get

 
;

 
set

  #
;

# $
}

% &
public 

string 
Message 
{ 
get 
;  
set! $
;$ %
}& '
} 
} ø

AC:\TSP.NET\Sysop-Squad\SysopSquad\Account.Microservice\Program.cs
	namespace

 	
Account


 
.

 
Microservice

 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} ∆$
AC:\TSP.NET\Sysop-Squad\SysopSquad\Account.Microservice\Startup.cs
	namespace 	
Account
 
. 
Microservice 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services
 
. 
AddControllers !
(! "
)" #
;# $
services
 
. 
AddDbContext 
<   
ApplicationDbContext  4
>4 5
(5 6
options6 =
=>> @
options   
.   
UseSqlServer    
(    !
Configuration  ! .
.  . /
GetConnectionString  / B
(  B C
$str  C L
)  L M
)  M N
)  N O
;  O P
services##
 
.## 
AddIdentity## 
<## 
ApplicationUser## .
,##. /
IdentityRole##0 <
>##< =
(##= >
)##> ?
.$$ $
AddEntityFrameworkStores$$ %
<$$% & 
ApplicationDbContext$$& :
>$$: ;
($$; <
)$$< =
.%% $
AddDefaultTokenProviders%% %
(%%% &
)%%& '
;%%' (
services((
 
.(( 
AddAuthentication(( $
((($ %
options((% ,
=>((- /
{)) 
options** 
.** %
DefaultAuthenticateScheme** /
=**0 1
JwtBearerDefaults**2 C
.**C D 
AuthenticationScheme**D X
;**X Y
options++ 
.++ "
DefaultChallengeScheme++ ,
=++- .
JwtBearerDefaults++/ @
.++@ A 
AuthenticationScheme++A U
;++U V
options,, 
.,, 
DefaultScheme,, #
=,,$ %
JwtBearerDefaults,,& 7
.,,7 8 
AuthenticationScheme,,8 L
;,,L M
}-- 
)-- 
.00 
AddJwtBearer00 
(00 
options00 !
=>00" $
{11 
options22 
.22 
	SaveToken22 
=22  !
true22" &
;22& '
options33 
.33  
RequireHttpsMetadata33 *
=33+ ,
false33- 2
;332 3
options44 
.44 %
TokenValidationParameters44 /
=440 1
new442 5%
TokenValidationParameters446 O
(44O P
)44P Q
{55 
ValidateIssuer66 
=66  
true66! %
,66% &
ValidateAudience77  
=77! "
true77# '
,77' (
ValidAudience88 
=88 
Configuration88  -
[88- .
$str88. A
]88A B
,88B C
ValidIssuer99 
=99 
Configuration99 +
[99+ ,
$str99, =
]99= >
,99> ?
IssuerSigningKey::  
=::! "
new::# & 
SymmetricSecurityKey::' ;
(::; <
Encoding::< D
.::D E
UTF8::E I
.::I J
GetBytes::J R
(::R S
Configuration::S `
[::` a
$str::a m
]::m n
)::n o
)::o p
};; 
;;; 
}<< 
)<< 
;<< 
}?? 	
publicBB 

voidBB 
	ConfigureBB 
(BB 
IApplicationBuilderBB -
appBB. 1
,BB1 2
IWebHostEnvironmentBB3 F
envBBG J
)BBJ K
{CC 	
appEE 
.EE 
UseHttpsRedirectionEE #
(EE# $
)EE$ %
;EE% &
appGG 
.GG 

UseRoutingGG 
(GG 
)GG 
;GG 
appII 
.II 
UseAuthorizationII  
(II  !
)II! "
;II" #
appKK 
.KK 
UseEndpointsKK 
(KK 
	endpointsKK &
=>KK' )
{LL 
	endpointsMM 
.MM 
MapControllersMM (
(MM( )
)MM) *
;MM* +
}NN 
)NN 
;NN 
}OO 	
}PP 
}QQ 